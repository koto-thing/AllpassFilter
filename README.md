# オールパスフィルタ
## 1次オールパスフィルタの差分方程式
$y[n] = -g \cdot x[n] + x[n - 1] + g \cdot y[n - 1]$

* x[n]: 現在の入力サンプル
* y[n]: 現在の出力サンプル
* x[n - 1]: 1サンプル前の入力サンプル
* y[n - 1]: 1サンプル前の出力サンプル
* g: フィードバック / フィードフォワード係数

## 伝達関数 
$H(z) = \frac{Y(z)}{X(z)} = \frac{-g + z^{-D}}{1 - g \cdot z^{-D}}$

* 振幅特性：周波数に関係なく常に1.0 (0 dB)
* 位相特性：周波数に依存し、信号の遅延を引き起こす

## フィードバックの計算
$v[n] = x[n] + g \cdot v[n - D]$

* v[n]: フィードバック信号
* D: 遅延サンプル数
* x[n]: 現在の入力サンプル
* v[n - D]: Dサンプル前のフィードバック信号
* g: フィードバック係数
* n: 現在のサンプルインデックス

## フィードフォワードの計算
$y[n] = v[n - D] - g \cdot v[n]$

* y[n]: 現在の出力サンプル
* v[n]: 現在のフィードバック信号
* v[n - D]: Dサンプル前のフィードバック信号
* g: フィードフォワード係数
* n: 現在のサンプルインデックス

## 遅延時間の補間
### 線形補間
$y(t) = (1 - t) \cdot x[i] + t \cdot x[i + 1]$

計算コスト：低い
音質：高域が減衰しやすい

* y(t): 補間された出力値
* x[i]: インデックスiのサンプル値
* x[i + 1]: インデックスi + 1のサンプル値
* t: 0から1の間の補間パラメータ

### 最近傍補間
$y(t) = x[round(p)]$

計算コスト：非常に低い
音質：補間制度が低く、遅延時間を動かすとノイズが発生しやすい

* y(t): 補間された出力値
* x[round(p)]: インデックスround(p)のサンプル値
* p: 補間位置

### 3次補間(ホーナー法)
$y(t) = ((a \cdot t + b) \cdot t + c) \cdot t + d$

このとき、

$a = -0.5p_0 + 1.5p_1 - 1.5p_2 + 0.5p_3$
$b = p_0 - 2.5p_1 + 2.0p_2 - 0.5p_3$
$c = -0.5p_0 + 0.5p_2$
$d = p_1$

計算コスト：高い
音質：高い、高域の減衰が少ない

* y(t): 補間された出力値
* p0, p1, p2, p3: 補間に使用する4つのサンプル値
* t: 0から1の間の補間パラメータ

## パラメータの平滑化
現在の値をy[n]、目標値をT、平滑化係数を$\alpha(0 < \alpha < 1)$とすると、

$y[n] = y[n - 1] + \alpha \cdot (T - y[n - 1])$

変形して、

$y[n] = (1 - \alpha) \cdot y[n - 1] + \alpha \cdot T$

* y[n]: 現在の平滑化された値
* y[n - 1]: 1サンプル前の平滑化された値
* T: 目標値
* α: 平滑化係数 (0 < α < 1)
  * αが小さいほど平滑化が強くなり、変化が遅くなる
  * αが大きいほど平滑化が弱くなり、変化が速くなる